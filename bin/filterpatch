#!/usr/bin/env bash
#
# Generates a patch from the result of applying a Unix filter to a set of files
#
# Example usage:
# find . -print0 | filter-patch "sed 's/foo/bar'"
#
# File list is read in from stdin, using null byte as separator
# Use with find -print0 or xargs -0

while IFS= read -r -d '' file; do
    eval $1 < $file | diff -Naur $file -
done
